<%= link_to "← retornar", back_path_or(images_path) %>

<div class="show-image">
  <h2><%= @image.description %></h2>
  <span class="with-serif smooth">Por </span>
  <b><%= link_to @image.user.name, user_path(@image.user) %></b>
  <span class="with-serif smooth">- Clique para ampliar</span>
  <p><%= link_to image_tag(@image.image.url(:medium)), @image.image.url %></p>
  
  <div class="comments">
    <% if @image.comments.any? %>
      <h3>Comentários</h3>
      <% for comment in @image.comments %>
        <p><%= link_to comment.user.name, user_path(comment.user) %> <%= comment.message %></p>
      <% end %>
    <% else %>
      <p class="hint">Nenhum comentário</span>
    <% end %>
    
    <%= flash_message %>

    <% if current_user %>
      <div style="text-align:center"><%= link_to_function "Adicionar comentário", nil, :id => "add-comment-link" %></div>
      <div id="comment-box" style="display:none">
        <% form_for @comment do |f| %>
          <p><%= f.text_area :message %></p>
          <%= f.hidden_field :commentable_type, :value => "image" %>
          <%= hidden_field_tag :parent_id, @image.id %>
          <div style="float:right"><%= f.submit "Comentar" %></div>
          <%= link_to_function "Cancelar", nil, :id => "cancel-comment-link" %>
        <% end %>
      </div>
    <% else %>
      <span class="hint">Você precisa estar logado para comentar</span>
    <% end %>
  </div>

</div>
<a name='bottom'>&nbsp;</a>

<script language="javascript">

  <% if flash[:comment_created] %>
    $(function() { window.location = "#bottom"; });
  <% end %>

  $("#add-comment-link").click(function() {
    $(this).hide();
    $(".success").hide();
    $("#comment-box").show();
    $("#comment-box textarea").focus();
    window.location = "#bottom";
  });
  
  $("#cancel-comment-link").click(function() {
    $("#comment-box").hide();
    $("#add-comment-link").show();
  });

</script>